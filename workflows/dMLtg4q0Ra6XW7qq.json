{"updatedAt":"2025-11-22T14:56:04.324Z","createdAt":"2025-08-21T07:20:45.275Z","id":"dMLtg4q0Ra6XW7qq","name":"Flo ideas dump","active":true,"isArchived":false,"nodes":[{"parameters":{"resource":"message","operation":"getAll","guildId":{"__rl":true,"value":"854285298476646421","mode":"list","cachedResultName":"Bunkerity","cachedResultUrl":"https://discord.com/channels/854285298476646421"},"channelId":{"__rl":true,"value":"1438910656307789965","mode":"id"},"options":{"simplify":true}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[-208,-112],"id":"fe1304c5-9a04-41ac-9abd-3e540f9219d1","name":"Get messages","webhookId":"5134460a-401b-443b-b90e-138de76ef58a","credentials":{"discordBotApi":{"id":"uNaipVUGxj7joc9H","name":"BunkerBot - Prod"}}},{"parameters":{"authentication":"webhook","content":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[1792,-16],"id":"8d0268b9-8b5e-4831-b9d8-a18ed9aa53d1","name":"Send message to tech","webhookId":"8a363a11-898a-4ee2-9103-b5fa7e072f25","credentials":{"discordWebhookApi":{"id":"ATIBYRCogmAtLDyA","name":"Discord Webhook - tech (flo dump)"}}},{"parameters":{"sortFieldsUi":{"sortField":[{"fieldName":"timestamp"}]},"options":{}},"type":"n8n-nodes-base.sort","typeVersion":1,"position":[240,-112],"id":"8852b5f8-8f80-4cf5-824d-c5acc285de28","name":"Sort by date"},{"parameters":{"options":{"systemMessage":"## ðŸ§  RÃ´le\n\nTu es **BunkerSummary**, agent spÃ©cialisÃ© dans la synthÃ¨se de **messages liÃ©s Ã  des tÃ¢ches** pour **Bunkerity** (Ã©diteur du WAF open source **BunkerWeb**).\n\nTu as accÃ¨s Ã  :\n\n* **La documentation officielle BunkerWeb** (seule source autorisÃ©e).\n* Un **outil de rÃ©flexion/planification** que tu dois **toujours utiliser avant de rÃ©diger**.\n* Un **outil de recherche externe**, pour les informations **hors BunkerWeb uniquement**.\n\nAucune invention : si un point touche BunkerWeb et nâ€™est pas confirmÃ© â†’ tu **consultes la doc**.\n\n---\n\n## ðŸŽ¯ Mission\n\nPour chaque lot de messages Discord (Markdown possible) :\n\n1. **Analyser profondÃ©ment** le contexte, la logique mÃ©tier, lâ€™intention et lâ€™impact sur les tÃ¢ches.\n2. **Planifier et structurer** systÃ©matiquement ta rÃ©flexion avant dâ€™Ã©crire.\n3. **Identifier** : faits, Ã©lÃ©ments techniques, dÃ©cisions, questions, ambiguÃ¯tÃ©s, risques, **tÃ¢ches**.\n4. **SynthÃ©tiser** en un rÃ©sumÃ© **clair, bref, exploitable**, orientÃ© **gestion de tÃ¢ches**.\n5. Rester dans le cadre Bunkerity/BunkerWeb (WAF NG, NGINX/ModSecurity, cloud-native, OWASP CRS, ClamAV, CrowdSec, Docker/K8s, DevOps, communautÃ© & entreprise).\n\n---\n\n## ðŸ§© Format de sortie\n\n1. **Contexte** (2â€“3 phrases max, si prÃ©sent).\n2. **Faits / Points importants** (3â€“8 bullets).\n3. **Actions Ã  mener (PRIORITÃ‰)**\n\n   * TÃ¢ches prÃ©cises et actionnables.\n   * Si aucune â†’ â€œ**Aucune action explicite.**â€\n4. **Risques / Blocages** (seulement ceux mentionnÃ©s).\n5. **SynthÃ¨se 1-phrase**.\n\n---\n\n## ðŸ§  Contraintes\n\n* **Toujours** rÃ©flÃ©chir et planifier avant dâ€™Ã©crire (mais **ne jamais le mentionner**).\n* Ton : professionnel, technique, direct, concis.\n* **Strictement â‰¤ 2000 caractÃ¨res (espaces compris)**.\n* Signaler toute incertitude : â€œ**AmbiguÃ¯tÃ© dÃ©tectÃ©e : â€¦**â€.\n* Si un point est validÃ© par la doc : â€œ**Selon la documentation BunkerWebâ€¦**â€.\n* Jamais de redondance, prioritÃ© :\n  **Actions > Risques > Points clÃ©s > Contexte**.\n* Pas de mention des outils utilisÃ©s."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[960,-112],"id":"05f58be7-00f3-4cab-8865-21ba4aef306a","name":"AI Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"memory_flo_dump"},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.5,"position":[816,112],"id":"7f266231-70f0-4b3d-9bea-9941a28cd1fa","name":"Redis","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"Get related chunks of the official BunkerWeb documentation.","tableName":"doc_embeddings","topK":1,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[944,112],"id":"a430604d-32ba-44b4-bdb0-a05ca06922d8","name":"BunkerWeb documentation","credentials":{"postgres":{"id":"epaaIS42N6tUKW8x","name":"Postgres container"}}},{"parameters":{"model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsAzureOpenAi","typeVersion":1,"position":[1024,320],"id":"bd4901b3-4d1f-43c0-8068-e9a7d38f03b2","name":"text-embedding-3-small","credentials":{"azureOpenAiApi":{"id":"b3h2PflJB1VhEfVA","name":"Azure Open AI Embedding - bunkerity"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-432,320],"id":"985796e5-792a-466d-96db-8c391094b841","name":"Wipe memory"},{"parameters":{"operation":"delete","key":"memory_flo_dump"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-208,320],"id":"b89a75de-aca9-40c5-b032-ac182b83da03","name":"Delete agent memory","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"description":"Think about you're about to say.\nIf necessary read the documentation for more information."},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1.1,"position":[1232,112],"id":"e58594cd-8bee-492a-8cf6-4719d3a0b578","name":"Think"},{"parameters":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}","options":{}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[1360,112],"id":"6afddd29-6951-4b9b-9181-4b11a6eb98e2","name":"Tavily","credentials":{"tavilyApi":{"id":"uy9TeiO4FnYJt9nC","name":"Tavily account - Bunkerity"}}},{"parameters":{"jsCode":"// Ce script suppose que chaque item entrant est UN message Discord.\n// Il formate tous les messages dans un texte unique en franÃ§ais.\n\nconst items = $input.all();\n\nconst blocks = items.map((item) => {\n  const msg = item.json;\n  const author = msg.author || {};\n\n  // Nom d'affichage si disponible, sinon username\n  const username =\n    author.global_name || author.username || \"Utilisateur inconnu\";\n\n  // Format de date en franÃ§ais (Fuseau horaire France)\n  const date = new Date(msg.timestamp);\n  const formattedDate = date.toLocaleString(\"fr-FR\", {\n    timeZone: \"Europe/Paris\",\n    year: \"numeric\",\n    month: \"2-digit\",\n    day: \"2-digit\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n  });\n\n  const content = msg.content || \"\";\n\n  return `${username} a dit le ${formattedDate} :\\n${content}\\n---`;\n});\n\n// Fusion des messages\nconst merged = blocks.join(\"\\n\");\n\nreturn {\n  json: {\n    chatInput: merged,\n  },\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[464,-112],"id":"3c5ca6ee-11d4-46cd-97cc-4f6ce445bd78","name":"Format messages"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0db5c99e-26c3-4e63-b29a-d0055d9ed532","leftValue":"={{ $json.output.length }}","rightValue":2000,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1568,-112],"id":"dabca88a-154b-4e60-843f-32d5e3bed76a","name":"If message is over 2000 chars"},{"parameters":{"authentication":"webhook","content":"## ðŸ’¾ New Flo dump","options":{},"files":{"values":[{}]}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[2016,-208],"id":"944464fe-a3ec-47e1-8b65-84215e693039","name":"Send file to tech","webhookId":"8a363a11-898a-4ee2-9103-b5fa7e072f25","credentials":{"discordWebhookApi":{"id":"ATIBYRCogmAtLDyA","name":"Discord Webhook - tech (flo dump)"}}},{"parameters":{"operation":"toText","sourceProperty":"output","options":{"fileName":"dump.md"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[1792,-208],"id":"a9b5e9b7-453a-4df6-ba9e-36260adfdc29","name":"Convert to File"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"f8aad714-1b70-4e8a-bd91-1e69d6f9fd5f","leftValue":"={{ $json.timestamp }}","rightValue":"={{ $now.minus(1, \"week\") }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[16,-112],"id":"51fdb395-6aad-4815-a003-6777cbd01956","name":"Get messages from last week"},{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[5],"triggerAtHour":14}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-432,-112],"id":"350b3b34-410f-4919-9de6-f27745cc62a3","name":"Every friday at 2pm"},{"parameters":{"model":"model-router","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[688,112],"id":"23c69a83-cfb3-4ba5-b80d-adfbd50c2189","name":"model-router","credentials":{"azureOpenAiApi":{"id":"mETD70EE7rTRYtAY","name":"Azure Router - Bunkerity"}}}],"connections":{"Get messages":{"main":[[{"node":"Get messages from last week","type":"main","index":0}]]},"Sort by date":{"main":[[{"node":"Format messages","type":"main","index":0}]]},"Redis":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"BunkerWeb documentation":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"text-embedding-3-small":{"ai_embedding":[[{"node":"BunkerWeb documentation","type":"ai_embedding","index":0}]]},"AI Agent":{"main":[[{"node":"If message is over 2000 chars","type":"main","index":0}]]},"Wipe memory":{"main":[[{"node":"Delete agent memory","type":"main","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Tavily":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Format messages":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"If message is over 2000 chars":{"main":[[{"node":"Convert to File","type":"main","index":0}],[{"node":"Send message to tech","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"Send file to tech","type":"main","index":0}]]},"Get messages from last week":{"main":[[{"node":"Sort by date","type":"main","index":0}]]},"Every friday at 2pm":{"main":[[{"node":"Get messages","type":"main","index":0}]]},"model-router":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Every day at 8am":{"recurrenceRules":[]},"node:Every friday at 2pm":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"172ac7c1-12d6-41ee-965f-3c4380133312","triggerCount":1,"shared":[{"updatedAt":"2025-09-15T15:10:15.425Z","createdAt":"2025-09-15T15:10:15.425Z","role":"workflow:owner","workflowId":"dMLtg4q0Ra6XW7qq","projectId":"ZjBkzD6jhnG4YX2d"}],"tags":[]}