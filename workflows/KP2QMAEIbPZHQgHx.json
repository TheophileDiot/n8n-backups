{"updatedAt":"2025-11-13T16:13:35.441Z","createdAt":"2025-08-22T17:02:38.748Z","id":"KP2QMAEIbPZHQgHx","name":"Search BunkerWeb through Hacker News","active":true,"isArchived":false,"nodes":[{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"7cad6d4b-88fa-41fd-8b1c-49251513eb17","leftValue":"={{ $json.in_cache }}","rightValue":"=1","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[144,-752],"id":"41510ed5-6c85-46a7-979d-76c4eab9b026","name":"Hasn't been processed already"},{"parameters":{"operation":"get","propertyName":"in_cache","key":"=hn_{{ $json.id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-304,-656],"id":"ab270405-4ffc-4b1b-81e8-783cf477ae3f","name":"Get cached ID","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-80,-752],"id":"f2b76b30-89da-4ab4-b393-432726a16c0c","name":"Merge cached response and entity"},{"parameters":{"content":"## ðŸ’¾ Filter already processed statuses.","height":352,"width":640,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-352,-848],"typeVersion":1,"id":"ae816508-5ed4-4117-b659-29924f9153f8","name":"Sticky Note3"},{"parameters":{"sortFieldsUi":{"sortField":[{"fieldName":"created_at"}]},"options":{}},"type":"n8n-nodes-base.sort","typeVersion":1,"position":[1488,-800],"id":"06900a16-f964-4a5a-aeba-5bd2d58305f3","name":"Sort by creation date"},{"parameters":{"authentication":"webhook","content":"=","options":{"wait":true},"embeds":{"values":[{"description":"={{ $json.content }}","author":"={{ $json.author }}","color":"#ff4000","timestamp":"={{ $json.created_at }}","title":"=ðŸ§‘â€ðŸ’» New Hacker News {{ $json.type }}!","url":"={{ $json.hn_url }}"}]}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[1936,-832],"id":"3be4d163-8833-43f4-a81e-ae7cb7a45d63","name":"Alert discord","webhookId":"3c97364e-0856-4a4d-8cee-62e70a9c8340","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"discordWebhookApi":{"id":"2oqKEjJqfEfwORxZ","name":"Discord Webhook social alerts"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1712,-800],"id":"1b5eefa9-2036-460c-ab89-5ccf5a895466","name":"Loop Over Items"},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2736,-848],"id":"ec1c524e-471a-4680-bc56-cd3eb3029bd3","name":"Wait 1 second","webhookId":"1bd98269-b7a1-419c-b7a7-7f29e0389f12"},{"parameters":{"content":"## ðŸ“¨ Inform the Bunker team on Discord and save processed entities in the cache","height":320,"width":1248,"color":6},"type":"n8n-nodes-base.stickyNote","position":[1648,-960],"typeVersion":1,"id":"464ab9be-8ddc-4252-8627-da4dc93a6a53","name":"Sticky Note2"},{"parameters":{"operation":"set","key":"=hn_{{ $json.id }}","value":"1","expire":true,"ttl":"={{ DateTime.fromSeconds(0).plus(1, \"month\").toSeconds() }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2512,-928],"id":"ca4378a7-cf0c-4b74-8f5a-e7f0deab1a0a","name":"Save processed ID","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"assignments":{"assignments":[{"id":"955d62d6-8516-4ba3-85ff-1c9d16cc679c","name":"created_at","value":"={{ DateTime.fromISO($json.created_at) }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1264,-800],"id":"1a16140b-4f07-42f9-854d-b02bfb9bce4b","name":"Convert date string to datetime"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{"clashHandling":{"values":{"resolveClash":"preferInput1"}}}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2224,-928],"id":"d05328f6-dcff-46e5-8f2b-b044f7c3fa4f","name":"Merge tweet data with discord response"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1200,176],"id":"1a5c981b-770a-474d-96d5-34fc0d8cda24","name":"Clear processed IDs"},{"parameters":{"jsCode":"return Object.keys($input.first().json).map(k => {\n  return { json: { key: k } };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-752,176],"id":"cf7122d1-b887-418a-86e5-b8e7d382534c","name":"Extract keys"},{"parameters":{"operation":"delete","key":"={{ $json.key }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-528,176],"id":"2044ba39-b81a-412a-b0f3-ae35b567c75a","name":"Delete extracted keys","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"url":"https://hn.algolia.com/api/v1/search","sendQuery":true,"queryParameters":{"parameters":[{"name":"query","value":"\"BunkerWeb\""},{"name":"tags","value":"(story,comment),-author_bnkty"},{"name":"hitsPerPage","value":"50"},{"name":"page","value":"0"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-976,-752],"id":"d7254e1b-528f-44f4-ae68-88fbb3582427","name":"Search Hacker News for BunkerWeb keyword"},{"parameters":{"jsCode":"// Input: Algolia HN search API response with \"hits\"\n// Output: one item per hit, normalized with all useful fields\n\nconst out = [];\nconst seen = new Set();\n\nfor (const item of items) {\n  const hits = (item.json && item.json.hits) || [];\n  for (const h of hits) {\n    const id = h.objectID;\n    if (!id || seen.has(id)) continue;\n    seen.add(id);\n\n    const isComment = (h._tags || []).includes('comment');\n\n    // Main title: use comment snippet or story title\n    const title =\n      h.title ||\n      h.story_title ||\n      (isComment ? '(comment)' : '(no title)');\n\n    // Direct story link (if any)\n    const storyUrl = h.url || h.story_url || null;\n\n    // Always provide the HN discussion link\n    const hnUrl = `https://news.ycombinator.com/item?id=${id}`;\n\n    out.push({\n      json: {\n        // Basic identifiers\n        id,\n        type: isComment ? 'comment' : 'story',\n        author: h.author ?? null,\n\n        // Content\n        title,\n        story_url: storyUrl,\n        hn_url: hnUrl,\n        comment_text: h.comment_text ?? null,\n\n        // Metadata\n        points: h.points ?? null,\n        num_comments: h.num_comments ?? null,\n        created_at: h.created_at ?? null,     // ISO timestamp\n        created_at_i: h.created_at_i ?? null, // epoch seconds\n        story_id: h.story_id ?? null,\n        parent_id: h.parent_id ?? null,\n        tags: h._tags || [],\n\n        // Raw for debugging\n        raw: h\n      }\n    });\n  }\n}\n\nreturn out;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-752,-752],"id":"98b626d5-c50f-4dc4-934b-073818c50334","name":"Parse hits"},{"parameters":{"operation":"keys","keyPattern":"hn_*"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-976,176],"id":"c14006ee-7637-400a-a9b2-5755f7dab59f","name":"Get all hn_* keys","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"62a0f7f4-a08a-4c72-9b71-2279befb46cc","leftValue":"={{ $json.type }}","rightValue":"story","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[368,-752],"id":"de9208e1-bfb7-4c31-bfe7-dd10181e069c","name":"If is a story"},{"parameters":{"keys":{"key":[{"currentKey":"title","newKey":"content"}]},"additionalOptions":{}},"type":"n8n-nodes-base.renameKeys","typeVersion":1,"position":[816,-944],"id":"c0b5009e-ba34-4828-9de1-13a82d03720d","name":"Rename title -> content"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[592,-192],"id":"62a24e13-e952-4d4b-8b30-3b3b04fec683","name":"Loop Over entities"},{"parameters":{"content":"### ðŸ“ Convert the HTML comment to markdown using Gemini 2.5 flash and fallback to llama3.2.","height":432,"width":560,"color":5},"type":"n8n-nodes-base.stickyNote","position":[2112,-336],"typeVersion":1,"id":"1d33d05b-b2b6-4c78-bbc8-900b5cab250e","name":"Sticky Note"},{"parameters":{"content":"## â³ Handle Gemini 2.5 flash API rate limit (10 requests per minute).","height":640,"width":1520,"color":4},"type":"n8n-nodes-base.stickyNote","position":[560,-528],"typeVersion":1,"id":"6c8fc429-7cbe-4f0c-aa3b-6f99ad5b4a02","name":"Sticky Note1"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[816,-704],"id":"9481eec9-6d1c-4480-b69c-3186f3d13c31","name":"Merge summary"},{"parameters":{"keys":{"key":[{"currentKey":"text","newKey":"content"}]},"additionalOptions":{}},"type":"n8n-nodes-base.renameKeys","typeVersion":1,"position":[2512,-144],"id":"1c171991-ff6e-419f-8520-05e52b31e15d","name":"Rename output -> summary"},{"parameters":{"model":"llama3.2:3b","options":{"lowVram":true,"useMLock":true,"useMMap":true}},"type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[2304,-48],"id":"b2bd6302-9e32-459d-b0a4-5ac856f06949","name":"llama3.2","credentials":{"ollamaApi":{"id":"1LHuJ7liAjGaSUJT","name":"Ollama account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[2176,-48],"id":"459c04e4-9e6b-4509-a2c9-53f46fb85a1d","name":"Gemini 2.5 flash","credentials":{"googlePalmApi":{"id":"GNtLDT3w0YRmjHrT","name":"Gemini Api -  tdiot@bunkerity.com"}}},{"parameters":{"amount":65},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1488,-416],"id":"671ab522-d6af-401b-a21e-7ad3934f3c42","name":"Wait for the gemini API rate limit to end","webhookId":"19ce6afd-5f60-4e89-a7db-2fe2abd51c5a"},{"parameters":{"operation":"get","propertyName":"gemini_flash_executions","key":"gemini_flash_executions","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[816,-48],"id":"6a5a6a2a-c601-4f61-81d4-3416f8847eae","name":"Get gemini flash executions","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1040,-192],"id":"c9577230-02f5-4649-ae48-88c5ce6be637","name":"Add gemini_flash_executions key"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8152c702-f81c-471b-a7bc-33c4fedc9593","leftValue":"={{ $json.gemini_flash_executions }}","rightValue":10,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1264,-192],"id":"be5aa426-7c68-47d1-a6eb-0f6f422ae918","name":"If there's been 10 executions or more"},{"parameters":{"operation":"delete","key":"gemini_flash_executions"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1712,-480],"id":"16406c67-1d96-4f62-bc60-4b8576022c0c","name":"Delete gemini_flash_executions","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"operation":"incr","key":"gemini_flash_executions","expire":true,"ttl":65},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1488,-48],"id":"c3c31c38-302f-421c-a23c-46a0d2ca7303","name":"Increment gemini_flash_executions","credentials":{"redis":{"id":"AfgIqWjfLKZzroBz","name":"Redis db 1"}}},{"parameters":{"promptType":"define","text":"=You are an expert text converter. Convert the given HTML into clean, Discord-compatible Markdown formatting.  \n- Preserve text meaning while removing unsupported tags.  \n- Convert <b> and <strong> to **bold**.  \n- Convert <i> and <em> to *italic*.  \n- Convert <u> to __underline__.  \n- Convert <a href=\"URL\">text</a> into [text](URL).  \n- Convert <code> and <pre> into inline code or code blocks with backticks.  \n- Convert lists (<ul>, <ol>, <li>) into proper Markdown bullet points or numbered lists.  \n- Remove any remaining raw HTML that Discord cannot render.  \n\nInput: {{ $json.comment_text }}\nOutput: Discord-ready Markdown.","needsFallback":true,"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[2160,-272],"id":"a5274425-af3f-4e2c-85da-bd214fb54b89","name":"HTML -> Markdown"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1712,-128],"id":"f21d7e0c-2b00-4792-88ac-c90500149b68","name":"Merge increment"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1936,-416],"id":"0fdf9615-c2a7-4443-98b6-166453efc4c2","name":"Merge wait"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1040,-800],"id":"10534605-a634-43d7-a8e5-25899263d392","name":"Merge all"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6c92d84b-d044-4b44-82ec-f1a50f31ebaa","leftValue":"={{ $json.created_at }}","rightValue":"={{ $now.minus('1', 'day') }}","operator":{"type":"dateTime","operation":"afterOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-528,-752],"id":"750a81cf-1ca0-426c-b5bd-1c33359a919b","name":"Created in the last 24H"},{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":4}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1200,-752],"id":"d7cb9138-6f98-42c2-b7d3-984c9f7ba751","name":"Every 4 hour"}],"connections":{"Hasn't been processed already":{"main":[[{"node":"If is a story","type":"main","index":0}]]},"Get cached ID":{"main":[[{"node":"Merge cached response and entity","type":"main","index":1}]]},"Merge cached response and entity":{"main":[[{"node":"Hasn't been processed already","type":"main","index":0}]]},"Sort by creation date":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Alert discord":{"main":[[{"node":"Merge tweet data with discord response","type":"main","index":1}]]},"Loop Over Items":{"main":[[],[{"node":"Merge tweet data with discord response","type":"main","index":0},{"node":"Alert discord","type":"main","index":0}]]},"Wait 1 second":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Save processed ID":{"main":[[{"node":"Wait 1 second","type":"main","index":0}]]},"Convert date string to datetime":{"main":[[{"node":"Sort by creation date","type":"main","index":0}]]},"Merge tweet data with discord response":{"main":[[{"node":"Save processed ID","type":"main","index":0}]]},"Clear processed IDs":{"main":[[{"node":"Get all hn_* keys","type":"main","index":0}]]},"Extract keys":{"main":[[{"node":"Delete extracted keys","type":"main","index":0}]]},"Search Hacker News for BunkerWeb keyword":{"main":[[{"node":"Parse hits","type":"main","index":0}]]},"Parse hits":{"main":[[{"node":"Created in the last 24H","type":"main","index":0}]]},"Get all hn_* keys":{"main":[[{"node":"Extract keys","type":"main","index":0}]]},"If is a story":{"main":[[{"node":"Rename title -> content","type":"main","index":0}],[{"node":"Merge summary","type":"main","index":0},{"node":"Loop Over entities","type":"main","index":0}]]},"Rename title -> content":{"main":[[{"node":"Merge all","type":"main","index":0}]]},"Loop Over entities":{"main":[[{"node":"Merge summary","type":"main","index":1}],[{"node":"Get gemini flash executions","type":"main","index":0},{"node":"Add gemini_flash_executions key","type":"main","index":0}]]},"Rename output -> summary":{"main":[[{"node":"Loop Over entities","type":"main","index":0}]]},"llama3.2":{"ai_languageModel":[[{"node":"HTML -> Markdown","type":"ai_languageModel","index":1}]]},"Gemini 2.5 flash":{"ai_languageModel":[[{"node":"HTML -> Markdown","type":"ai_languageModel","index":0}]]},"Wait for the gemini API rate limit to end":{"main":[[{"node":"Delete gemini_flash_executions","type":"main","index":0},{"node":"Merge wait","type":"main","index":1}]]},"Get gemini flash executions":{"main":[[{"node":"Add gemini_flash_executions key","type":"main","index":1}]]},"Add gemini_flash_executions key":{"main":[[{"node":"If there's been 10 executions or more","type":"main","index":0}]]},"If there's been 10 executions or more":{"main":[[{"node":"Wait for the gemini API rate limit to end","type":"main","index":0}],[{"node":"Increment gemini_flash_executions","type":"main","index":0},{"node":"Merge increment","type":"main","index":0}]]},"Merge summary":{"main":[[{"node":"Merge all","type":"main","index":1}]]},"HTML -> Markdown":{"main":[[{"node":"Rename output -> summary","type":"main","index":0}]]},"Increment gemini_flash_executions":{"main":[[{"node":"Merge increment","type":"main","index":1}]]},"Merge increment":{"main":[[{"node":"HTML -> Markdown","type":"main","index":0}]]},"Delete gemini_flash_executions":{"main":[[{"node":"Merge wait","type":"main","index":0}]]},"Merge wait":{"main":[[{"node":"HTML -> Markdown","type":"main","index":0}]]},"Merge all":{"main":[[{"node":"Convert date string to datetime","type":"main","index":0}]]},"Created in the last 24H":{"main":[[{"node":"Merge cached response and entity","type":"main","index":0},{"node":"Get cached ID","type":"main","index":0}]]},"Every 4 hour":{"main":[[{"node":"Search Hacker News for BunkerWeb keyword","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Every day":{"recurrenceRules":[]},"node:Every hour":{"recurrenceRules":[]},"node:Every 4 hour":{"recurrenceRules":[16]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"f390fc1d-1ca9-40e8-9e48-21cf1c4065a1","triggerCount":1,"shared":[{"updatedAt":"2025-09-15T15:10:15.425Z","createdAt":"2025-09-15T15:10:15.425Z","role":"workflow:owner","workflowId":"KP2QMAEIbPZHQgHx","projectId":"ZjBkzD6jhnG4YX2d"}],"tags":[{"updatedAt":"2025-08-13T09:13:48.874Z","createdAt":"2025-08-13T09:13:48.874Z","id":"Af5V1Rr0ynGVFcvN","name":"Social"}]}